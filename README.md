# 📘 TW_Stock 前端頁面結構說明 (`index.html`)

更新日期：2025-11-26  
版本：穩定版（含新版觀察清單、K 線圖、AI 供應鏈 tags）

---

## 🏗️ 頁面總覽

`index.html` 為 TW_Stock 專案的主要前端頁面，用於顯示每日法人買賣超、投本比/外本比、多日觀察、K 線圖與異常偵測。

頁面內容分為四個主要區塊：

1. **上方 Tabs：觀察清單 / 個股查詢**
2. **上半部：指標觀察清單（整合 insights.json + newcomers + explosive）**
3. **中間區塊：新上榜 + 爆量偵測（左右並列）**
4. **下半部：個股查詢 + K 線圖 + 法人買賣超表格**

---

# 🧩 上方 Tabs：切換模式

| Tab | 說明 |
|-----|------|
| ⭐ 觀察清單 | 顯示 insights.json、newcomers.json、explosive.json 的整合列表 |
| 📈 個股查詢 | 可查詢個股法人買賣超、K 線圖、AI 供應鏈分類 |

---

# 🧠 上半部（觀察清單）：法人摘要清單

新版觀察清單整合三類資料：

| 區塊 | 來源檔案 | 說明 |
|------|-----------|------|
| 🌏 外資投本比前10 | `insights.json` → `foreign_ratio_ranking` | 過去多日累計最強買超 |
| 🏦 投信投本比前10 | `insights.json` → `invest_ratio_ranking` | 投信累計買超強勢 |
| 🔴 雙紅標記 | insights 自帶邏輯 | 同時出現在外資 & 投信 → 紅色加粗 |

（同時保留原本的 5 日/10 日外本比、投本比邏輯）

---

# ⚡ 中間區塊：新上榜 + 爆量偵測（左右並排）

使用桌機雙欄、手機單欄顯示。

| 區塊 | 來源檔案 | 顯示邏輯 |
|------|-----------|-----------|
| 🚀 新上榜 | `newcomers.json` | 與過去 10 日相比首次上榜 |
| 🔥 爆量偵測 | `explosive.json` | 連續買超 + 今日成交量 ≥ 昨日×3 |

### **爆量偵測邏輯（最新 v2025-11 版）**
1. 昨日法人合計（外+投+自）為正值  
2. 今日法人合計也為正值  
3. 今日 ≥ 昨日 × **3 倍以上**  
4. 排除昨日 < 1000 張（避免假爆量）  
5. 排除 ETF / ETN（只顯示四位數股票）  

---

# 📈 下半部：個股查詢 → K 線圖 + 法人表格

## 🔍 搜尋功能
- 支援股票代號 / 名稱搜尋  
- 自動清除按鈕（X）  
- 自動更新標題：「法人買賣超查詢 - {名稱} ({代號})」

---

# 📊 個股 K 線圖（Lightweight Charts）

| 功能 | 說明 |
|------|------|
| 🕯️ K 線圖 | 蠟燭圖顯示 OHLC |
| 📉 均線 | 5MA / 10MA / 20MA / 60MA |
| 📊 量能 | 底部 Volume 條狀 |
| 🧩 不受桌機 scale-150 影響 | 使用 `.no-scale-chart` |

資料來源：`Kline.json`（由 daily.py 每日更新並自動補齊缺漏日）

---

# 🧾 法人買賣超表格

| 欄位 | 說明 |
|------|------|
| 日期 | 交易日 |
| 外資 | 張數（正紅、負綠） |
| 投信 | 張數 |
| 自營商 | 張數 |
| 合計 | 整體買賣超 |

---

# 🧩 JSON 檔案對應關係（最新版）

| 檔案 | 用途 | 更新來源 |
|------|------|-----------|
| `data.json` | 主要法人買賣超（約 30–90 天） | `daily.py` |
| `Kline.json` | 個股 K 線資料 | `daily.py` + 補資料機制 |
| `insights.json` | 外/投本比前10摘要 | `generate_insights.py` |
| `newcomers.json` | 新上榜 | `tw_newcomers_10d_line_push.py` |
| `explosive.json` | 爆量偵測 | `tw_explosive_buy_line_push.py` |
| **`industry_tags.json`** | AI 供應鏈分類（11 大鏈） | 最新 AI 標籤系統 |

---

# 🧬 AI 供應鏈分類（新增）

自 2025-11 起新增 `industry_tags.json`，  
提供 **11 大 AI 伺服器供應鏈分類**，包含：

1. 材料（銅箔、玻纖布、CCL、矽晶圓）
2. ABF + PCB
3. 先進封裝（含 CoWoS）
4. 電源供應
5. 散熱
6. 光通訊 / CPO
7. 功率半導體
8. 記憶體（DRAM / SSD / NOR）
9. 被動元件
10. 伺服器 ODM
11. 機殼機櫃

此分類會出現在「個股查詢」區塊內，提供額外資訊。

---

# 🧭 RWD 設計重點（維持原本穩定版設定）

| 裝置 | 行為 |
|------|------|
| 桌機 | 主容器 `scale-150` 放大 |
| 手機 | 自動取消縮放，單欄排版 |
| 圖表 | `.no-scale-chart` 避免圖被放大 |

Tailwind CSS v2.2.19，無外掛依賴。

---

# 📄 更新紀錄（延伸版）

| 日期 | 更新項目 |
|------|-----------|
| **2025-11-26** | 新增 K 線圖（Lightweight Charts）、新增 AI 供應鏈分類、更新觀察清單整合版 UI |
| 2025-10-23 | 新增爆量偵測區塊、整合 `explosive.json` |
| 2025-10-20 | index.html 穩定版確立（桌機 scale-150 + 手機調整） |
| 2025-10-07 | 新上榜邏輯整合進 workflow |
| 2025-09-27 | TPEX JSON fallback 設計 |

---

© Derek Tsai  
CONTACT: **derektsai0428@gmail.com**
