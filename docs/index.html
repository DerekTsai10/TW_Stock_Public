<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="utf-8">
  <title>æ³•äººè²·è³£è¶…æŸ¥è©¢</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="p-6 bg-gray-50 text-base">
  <h1 id="page-title" class="text-3xl font-bold mb-6">æ³•äººè²·è³£è¶…æŸ¥è©¢</h1>

  <!-- æœå°‹æ¡† -->
  <div class="mb-6">
    <label for="search-input" class="block text-sm font-medium text-gray-700 mb-1">è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼æˆ–åç¨±ï¼š</label>
    <input id="search-input" type="text" placeholder="å°ç©é›» æˆ– 2330"
      class="w-full p-2 border rounded-md shadow-sm focus:ring focus:ring-blue-200 focus:border-blue-400">
  </div>

  <!-- ä¸ŠåŠéƒ¨ï¼šæŒ‡æ¨™è§€å¯Ÿæ¸…å–® + æ–°ä¸Šæ¦œ + æˆäº¤é‡æš´å¢ -->
  <div class="grid grid-cols-2 gap-6">
    <!-- å·¦é‚Šï¼šæŒ‡æ¨™è§€å¯Ÿæ¸…å–® -->
    <div class="bg-white shadow rounded-2xl p-4">
      <h2 class="text-xl font-bold mb-2">ğŸ“Š æŒ‡æ¨™è§€å¯Ÿæ¸…å–® (è³‡æ–™æ—¥æœŸï¼š<span id="insights-date"></span>)</h2>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <h3 class="font-bold mb-1">ğŸŒ å¤–è³‡è²·è¶…æŠ•æœ¬æ¯”å‰ 10</h3>
          <ul id="foreign-top10" class="list-disc list-inside space-y-1"></ul>
        </div>
        <div>
          <h3 class="font-bold mb-1">ğŸ¦ æŠ•ä¿¡è²·è¶…æŠ•æœ¬æ¯”å‰ 10</h3>
          <ul id="invest-top10" class="list-disc list-inside space-y-1"></ul>
        </div>
      </div>
    </div>

    <!-- å³é‚Šï¼šæ–°ä¸Šæ¦œ + æˆäº¤é‡æš´å¢ -->
    <div class="bg-white shadow rounded-2xl p-4">
      <h2 class="text-xl font-bold mb-2">ğŸš€ æ–°ä¸Šæ¦œ</h2>
      <p id="newcomers-date" class="text-sm text-gray-500 mb-3">è³‡æ–™æ—¥æœŸï¼š</p>

      <div id="foreign-newcomers" class="mb-4"></div>
      <div id="invest-newcomers" class="mb-4"></div>

      <!-- æˆäº¤é‡æš´å¢ -->
      <h2 class="text-xl font-bold mt-6 mb-2">ğŸ”¥ æˆäº¤é‡æš´å¢ (å‰ 10 æª”)</h2>
      <div id="volume-spike"></div>
    </div>
  </div>

  <!-- ä¸‹åŠéƒ¨ï¼šEPS å€å¡Š -->
  <div class="bg-white shadow rounded-2xl p-4 mt-6">
    <h2 class="text-xl font-bold mb-2">ğŸ’° EPS è¶¨å‹¢</h2>
    <canvas id="eps-chart" class="w-full h-64"></canvas>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    async function loadInsights() {
      const res = await fetch("insights.json");
      const data = await res.json();

      document.getElementById("insights-date").innerText = data.date;

      // å¤–è³‡ Top10
      let fhtml = "";
      data.foreign_ratio_ranking.forEach(s => {
        fhtml += `<li>${s.name} (${s.stock_id}) - ${s.foreign_ratio.toFixed(2)}%</li>`;
      });
      document.getElementById("foreign-top10").innerHTML = fhtml;

      // æŠ•ä¿¡ Top10
      let ihtml = "";
      data.invest_ratio_ranking.forEach(s => {
        ihtml += `<li>${s.name} (${s.stock_id}) - ${s.invest_ratio.toFixed(2)}%</li>`;
      });
      document.getElementById("invest-top10").innerHTML = ihtml;
    }

    async function loadNewcomers() {
      const res = await fetch("newcomers.json");
      const data = await res.json();

      document.getElementById("newcomers-date").innerText = "è³‡æ–™æ—¥æœŸï¼š" + data.date;

      renderNewcomerList("foreign-newcomers", "å¤–è³‡æ–°ä¸Šæ¦œ", data.newcomers.foreign);
      renderNewcomerList("invest-newcomers", "æŠ•ä¿¡æ–°ä¸Šæ¦œ", data.newcomers.invest);
      renderVolumeSpike("volume-spike", data.volume_spike);
    }

    function renderNewcomerList(containerId, title, list) {
      let html = `<h3 class="font-bold mb-1">ğŸ“Œ ${title}ï¼š</h3>`;

      if (!list || list.length === 0) {
        html += `<p class="text-gray-400">ï¼ˆç„¡ï¼‰</p>`;
        document.getElementById(containerId).innerHTML = html;
        return;
      }

      if (list.length <= 3) {
        html += `<ul class="list-disc list-inside space-y-1">`;
        list.forEach(s => {
          html += `<li>${s.name} (${s.stock_id}) - ${s.ratio.toFixed(2)}%</li>`;
        });
        html += `</ul>`;
      } else {
        const left = list.slice(0, 3);
        const right = list.slice(3, 6);

        html += `<div class="grid grid-cols-2 gap-4">`;

        html += `<div><ul class="list-disc list-inside space-y-1">`;
        left.forEach(s => {
          html += `<li>${s.name} (${s.stock_id}) - ${s.ratio.toFixed(2)}%</li>`;
        });
        html += `</ul></div>`;

        html += `<div><ul class="list-disc list-inside space-y-1">`;
        right.forEach(s => {
          html += `<li>${s.name} (${s.stock_id}) - ${s.ratio.toFixed(2)}%</li>`;
        });
        html += `</ul></div>`;

        html += `</div>`;
      }

      document.getElementById(containerId).innerHTML = html;
    }

    function renderVolumeSpike(containerId, list) {
      let html = "";

      if (!list || list.length === 0) {
        html = `<p class="text-gray-400">ï¼ˆä»Šæ—¥ç„¡æˆäº¤é‡æš´å¢è‚¡ç¥¨ï¼‰</p>`;
      } else {
        // å–å‰ 10 æª”å€ç‡æœ€é«˜çš„è‚¡ç¥¨
        list = list.sort((a, b) => b.ratio - a.ratio).slice(0, 10);

        html = `<ul class="list-disc list-inside space-y-1">`;
        list.forEach(s => {
          html += `<li>${s.name} (${s.stock_id}) - ${s.ratio}x</li>`;
        });
        html += `</ul>`;
      }

      document.getElementById(containerId).innerHTML = html;
    }

    // EPS Chart
    async function loadEPS(stockId="2330") {
      const res = await fetch("eps.json");
      const data = await res.json();
      const epsData = data[stockId] || [];

      const ctx = document.getElementById("eps-chart").getContext("2d");
      new Chart(ctx, {
        type: "line",
        data: {
          labels: epsData.map(d => d.date),
          datasets: [{
            label: "EPS",
            data: epsData.map(d => d.eps),
            borderColor: "blue",
            fill: false
          }]
        }
      });
    }

    loadInsights();
    loadNewcomers();
    loadEPS();
  </script>
</body>
</html>
