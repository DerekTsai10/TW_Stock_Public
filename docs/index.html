<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æ¯æ—¥æ³•äººè²·è³£è¶…ç´€éŒ„</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 40px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #333; color: white; }
    tr:nth-child(even) { background: #f9f9f9; }
    .pos { color: red; font-weight: bold; }
    .neg { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h1>æ¯æ—¥æ³•äººè²·è³£è¶…ç´€éŒ„</h1>
  <div id="tables"></div>

  <script>
    async function loadData() {
      const resp = await fetch("data.json?ts=" + new Date().getTime());
      const data = await resp.json();
      console.log("DEBUG: data.json content =", data); // ğŸ Debug ç”¨

      const container = document.getElementById("tables");
      container.innerHTML = "";

      for (const stock in data) {
        const records = data[stock];
        if (!records || records.length === 0) {
          console.log(`âš ï¸ è‚¡ç¥¨ ${stock} æ²’æœ‰è³‡æ–™`);
          continue;
        }

        const name = records[0].name || "";
        const h2 = document.createElement("h2");
        h2.textContent = `${name} (${stock}) - éå»ä¸€å€‹æœˆæ³•äººè²·è³£è¶…`;
        container.appendChild(h2);

        const table = document.createElement("table");
        table.innerHTML = `
          <tr>
            <th>æ—¥æœŸ</th>
            <th>å¤–è³‡</th>
            <th>æŠ•ä¿¡</th>
            <th>è‡ªç‡Ÿå•†</th>
            <th>ä¸‰å¤§æ³•äººåˆè¨ˆ</th>
          </tr>
        `;

        // é¡¯ç¤ºæœ€è¿‘ 20 ç­†
        const recent = records.slice(-20);
        for (const row of recent) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row.date}</td>
            <td class="${row.foreign >= 0 ? 'pos' : 'neg'}">${row.foreign}</td>
            <td class="${row.trust >= 0 ? 'pos' : 'neg'}">${row.trust}</td>
            <td class="${row.dealer >= 0 ? 'pos' : 'neg'}">${row.dealer}</td>
            <td class="${row.total >= 0 ? 'pos' : 'neg'}">${row.total}</td>
          `;
          table.appendChild(tr);
        }

        container.appendChild(table);
      }
    }

    loadData();
  </script>
</body>
</html>
