<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="utf-8">
  <title>法人買賣超查詢</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="p-6 bg-gray-50 text-base">
  <h1 id="page-title" class="text-3xl font-bold mb-6">法人買賣超查詢</h1>

  <!-- 新上榜 -->
  <div class="bg-white shadow rounded-2xl p-4 mb-6">
    <h2 class="text-xl font-bold mb-2">🚀 新上榜</h2>
    <p id="newcomers-date" class="text-sm text-gray-500 mb-3">資料日期：</p>

    <div id="foreign-newcomers" class="mb-4"></div>
    <div id="invest-newcomers" class="mb-4"></div>
  </div>

  <!-- 成交量暴增 -->
  <div class="bg-white shadow rounded-2xl p-4 mb-6">
    <h2 class="text-xl font-bold mb-2">🔥 成交量暴增</h2>
    <div id="volume-spike"></div>
  </div>

  <script>
    async function loadNewcomers() {
      const res = await fetch("newcomers.json");
      const data = await res.json();

      document.getElementById("newcomers-date").innerText = "資料日期：" + data.date;

      renderNewcomerList("foreign-newcomers", "外資新上榜", data.newcomers.foreign);
      renderNewcomerList("invest-newcomers", "投信新上榜", data.newcomers.invest);

      renderVolumeSpike("volume-spike", data.volume_spike);
    }

    function renderNewcomerList(containerId, title, list) {
      let html = `<h3 class="font-bold mb-1">📌 ${title}：</h3>`;

      if (!list || list.length === 0) {
        html += `<p class="text-gray-400">（無）</p>`;
        document.getElementById(containerId).innerHTML = html;
        return;
      }

      if (list.length <= 3) {
        // 只有 3 檔以內 → 單欄
        html += `<ul class="list-disc list-inside space-y-1">`;
        list.forEach(s => {
          html += `<li>${s.name} (${s.stock_id}) - ${s.ratio.toFixed(2)}%</li>`;
        });
        html += `</ul>`;
      } else {
        // 超過 3 檔 → 左右兩欄
        const left = list.slice(0, 3);
        const right = list.slice(3, 6);

        html += `<div class="grid grid-cols-2 gap-4">`;

        // 左欄
        html += `<div><ul class="list-disc list-inside space-y-1">`;
        left.forEach(s => {
          html += `<li>${s.name} (${s.stock_id}) - ${s.ratio.toFixed(2)}%</li>`;
        });
        html += `</ul></div>`;

        // 右欄
        html += `<div><ul class="list-disc list-inside space-y-1">`;
        right.forEach(s => {
          html += `<li>${s.name} (${s.stock_id}) - ${s.ratio.toFixed(2)}%</li>`;
        });
        html += `</ul></div>`;

        html += `</div>`;
      }

      document.getElementById(containerId).innerHTML = html;
    }

    function renderVolumeSpike(containerId, list) {
      let html = "";

      if (!list || list.length === 0) {
        html = `<p class="text-gray-400">（今日無成交量暴增股票）</p>`;
      } else {
        html = `<ul class="list-disc list-inside space-y-1">`;
        list.forEach(s => {
          html += `<li>${s.name} (${s.stock_id}) - ${s.ratio}x</li>`;
        });
        html += `</ul>`;
      }

      document.getElementById(containerId).innerHTML = html;
    }

    loadNewcomers();
  </script>
</body>
</html>
