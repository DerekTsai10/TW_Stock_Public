<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>股票投資協助方案</title>
  <style>
    body { font-family: Arial, sans-serif; }
    #newcomers-box {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 10px;
      background: #f8f8f8;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 200px;
    }
    #newcomers-box h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
    }
    #newcomers-list {
      list-style-type: none;
      padding-left: 10px;
      margin: 0;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <!-- 新上榜清單 -->
  <div id="newcomers-box">
    <h4>新上榜 (過去10天)</h4>
    <ul id="newcomers-list"></ul>
  </div>

  <script>
  async function showNewcomers() {
    const res = await fetch("data.json");
    const data = await res.json();

    // 整理所有紀錄
    let allStocks = Object.values(data).flat();
    allStocks.sort((a, b) => a.date.localeCompare(b.date));

    // 最近十天日期
    let uniqueDates = [...new Set(allStocks.map(d => d.date))].sort();
    if (uniqueDates.length < 10) return;
    let last10 = uniqueDates.slice(-10);

    // 計算每天前15名
    let top15ByDay = {};
    last10.forEach(date => {
      let records = allStocks.filter(d => d.date === date);
      records.sort((a, b) => b.total - a.total);
      top15ByDay[date] = records.slice(0, 15).map(d => d.stock);
    });

    // 前9天集合
    let first9 = new Set(last10.slice(0, 9).flatMap(d => top15ByDay[d]));
    // 第10天新上榜
    let newcomers = top15ByDay[last10[9]].filter(stock => !first9.has(stock));

    // 顯示
    let ul = document.getElementById("newcomers-list");
    newcomers.forEach(stock => {
      let li = document.createElement("li");
      li.textContent = stock;
      ul.appendChild(li);
    });
  }

  showNewcomers();
  </script>
</body>
</html>
