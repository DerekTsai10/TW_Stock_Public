<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="utf-8">
  <title>æ³•äººè²·è³£è¶…æŸ¥è©¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    @media (max-width: 768px) {
      .mobile-reset { transform: scale(1) !important; padding: 1rem !important; }
      .mobile-col { grid-template-columns: 1fr !important; gap: 1.5rem !important; }
      .mobile-center { text-align: center !important; }
      input, select, button { font-size: 1rem; padding: 0.6rem 0.8rem; }
      h1 { font-size: 1.8rem; }
      h3 { font-size: 1.5rem; }
    }
    #suggestions { z-index: 20; }
    #clear-input-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #9ca3af;
      transition: color 0.15s;
    }
    #clear-input-btn:hover {
      color: #6b7280;
    }
  </style>
</head>

<body class="p-6 bg-gray-50 text-lg">
  <div class="max-w-7xl mx-auto transform scale-150 origin-top mobile-reset transition-transform duration-300">

    <h1 id="page-title" class="text-3xl font-bold mb-8 mobile-center">
      æ³•äººè²·è³£è¶…æŸ¥è©¢
    </h1>

    <div class="my-6 flex flex-col md:flex-row md:items-center md:space-x-3 relative w-full md:w-auto mx-auto md:mx-0">
      <label for="search-input" class="font-bold text-xl mb-2 md:mb-0 whitespace-nowrap mobile-center">
        è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼æˆ–åç¨±ï¼š
      </label>
      <div class="relative w-full md:w-80">
        <input type="text" id="search-input"
               placeholder="å°ç©é›» æˆ– 2330"
               class="w-full border p-3 rounded text-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-10"
               autocomplete="off"
               autofocus>
        <button id="clear-input-btn" class="absolute hidden focus:outline-none" title="æ¸…é™¤è¼¸å…¥">
            &times;
        </button>
        <ul id="suggestions"
            class="absolute w-full bg-white border rounded mt-1 shadow-lg hidden max-h-60 overflow-y-auto z-20 text-lg"></ul>
      </div>
    </div>

    <div id="insights-view">
      <div class="grid grid-cols-2 gap-6 mb-8 mobile-col">
        <div class="p-6 border rounded bg-white shadow">
          <h3 id="insights-title" class="font-bold text-2xl mb-6 mobile-center">ğŸ“Š æŒ‡æ¨™è§€å¯Ÿæ¸…å–®</h3>

          <div class="grid grid-cols-2 gap-6 text-gray-700">
            <div>
              <h4 class="font-semibold mb-3">ğŸŒ ç•¶æ—¥å¤–æœ¬æ¯”å‰ 10</h4>
              <ul id="foreign_ratio_list" class="list-disc pl-6 space-y-2 text-base"></ul>
            </div>
            <div>
              <h4 class="font-semibold mb-3">ğŸ¦ ç•¶æ—¥æŠ•æœ¬æ¯”å‰ 10</h4>
              <ul id="invest_ratio_list" class="list-disc pl-6 space-y-2 text-base"></ul>
            </div>
          </div>
          <div id="period-section" class="mt-8"></div>
        </div>

        <div class="p-6 border rounded bg-white shadow">
          <div class="grid grid-cols-2 gap-6 mobile-col">
            <div>
              <h3 class="font-bold text-2xl mb-4 mobile-center">ğŸš€ æ–°ä¸Šæ¦œ</h3>
              <div id="newcomers-container" class="text-gray-700 text-base">ï¼ˆæ­¤å€å¡Šæš«ä¸é¡¯ç¤ºå…§å®¹ï¼‰</div>
            </div>
            <div>
              <h3 class="font-bold text-2xl mb-4 mobile-center">ğŸ”¥ çˆ†é‡åµæ¸¬</h3>
              <div id="explosive-container" class="text-gray-700 text-base">ï¼ˆæ­¤å€å¡Šæš«ä¸é¡¯ç¤ºå…§å®¹ï¼‰</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="stock-view" class="hidden">
      
      <div id="price-chart-container" class="p-6 border rounded bg-white shadow mb-8">
        <h3 class="font-bold text-2xl mb-4 mobile-center">éå» 30 å¤©è‚¡åƒ¹ K ç·šåœ–</h3>
        <div id="candlestickChart" class="relative h-96">
          </div>
      </div>

      <div id="chart-container" class="p-6 border rounded bg-white shadow mb-8">
        <h3 class="font-bold text-2xl mb-4 mobile-center">æ³•äººè²·è³£è¶…è¶¨å‹¢åœ–</h3>
        <div class="relative h-96">
          <canvas id="tradingChart"></canvas>
        </div>
      </div>

      <div class="p-6 border rounded bg-white shadow overflow-x-auto">
        <h3 class="font-bold text-2xl mb-4 mobile-center">æ³•äººè²·è³£è¶… (å¼µ)</h3>
        <table id="trading-table" class="min-w-full text-center border-collapse border text-lg">
          <thead class="bg-gray-100">
            <tr>
              <th class="border px-4 py-3 whitespace-nowrap">æ—¥æœŸ</th>
              <th class="border px-4 py-3 whitespace-nowrap">å¤–è³‡</th>
              <th class="border px-4 py-3 whitespace-nowrap">æŠ•ä¿¡</th>
              <th class="border px-4 py-3 whitespace-nowrap">è‡ªç‡Ÿå•†</th>
              <th class="border px-4 py-3 whitespace-nowrap">åˆè¨ˆ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="5" class="border px-4 py-8 text-gray-500">
                è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼æˆ–åç¨±é€²è¡ŒæŸ¥è©¢
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
  let records = [];
  let stockList = [];
  let tradingChartInstance; // Chart.js å¯¦ä¾‹
  let candlestickChartInstance; // Lightweight Charts å¯¦ä¾‹
  let candleSeries; // Kç·šåœ–æ•¸æ“šç³»åˆ—å¯¦ä¾‹

  const input = document.getElementById("search-input");
  const suggestions = document.getElementById("suggestions");
  const tableBody = document.querySelector("#trading-table tbody");
  const pageTitle = document.getElementById("page-title");
  const clearBtn = document.getElementById("clear-input-btn");
  
  // é é¢è¦–åœ–å…ƒç´ 
  const insightsView = document.getElementById('insights-view'); 
  const stockView = document.getElementById('stock-view');     

  // --- é é¢æ¨¡å¼åˆ‡æ›å‡½å¼ ---
  function toggleView(view) {
    if (view === 'insights') {
      insightsView.classList.remove('hidden');
      stockView.classList.add('hidden');
      pageTitle.textContent = "æ³•äººè²·è³£è¶…æŸ¥è©¢";
    } else if (view === 'stock') {
      insightsView.classList.add('hidden');
      stockView.classList.remove('hidden');
    }
  }

  // --- K ç·šåœ–åˆå§‹åŒ– (Lightweight Charts) ---
  function initCandlestickChart() {
      if (candlestickChartInstance) return; // é¿å…é‡è¤‡åˆå§‹åŒ–
      
      const chartOptions = {
          layout: { backgroundColor: '#ffffff', textColor: 'rgba(33, 56, 120, 1)', },
          grid: { vertLines: { color: '#e0e0e0', }, horzLines: { color: '#e0e0e0', }, },
          crosshair: { mode: LightweightCharts.CrosshairMode.Normal, },
          priceScale: { borderColor: '#cccccc', },
          timeScale: { borderColor: '#cccccc', },
      };

      const chartElement = document.getElementById('candlestickChart');
      candlestickChartInstance = LightweightCharts.createChart(chartElement, chartOptions);
      candlestickChartInstance.timeScale().fitContent();
      candleSeries = candlestickChartInstance.addCandlestickSeries({
          upColor: '#ef5350',   // ç´…è‰² (æ¼²)
          downColor: '#26a69a', // ç¶ è‰² (è·Œ)
          borderVisible: false,
          wickUpColor: '#ef5350',
          wickDownColor: '#26a69a',
      });
  }


  // [å¾…å¯¦ä½œ] è‚¡åƒ¹ K ç·šæ•¸æ“šç²å–èˆ‡ç¹ªè£½ (æ¨¡æ“¬å‡½å¼)
  async function fetchPriceData(stockId) {
      console.log(`æ­£åœ¨æ¨¡æ“¬ç²å– ${stockId} çš„è‚¡åƒ¹æ•¸æ“š...`);
      return new Promise(resolve => {
          setTimeout(() => {
              // æ¨¡æ“¬éå»å¹¾å¤©çš„è‚¡åƒ¹æ•¸æ“š (Lightweight Charts æ ¼å¼)
              const mockData = [
                  { time: '2025-10-14', open: 120, high: 122, low: 118, close: 121 },
                  { time: '2025-10-15', open: 121, high: 125, low: 120, close: 124 },
                  { time: '2025-10-16', open: 124, high: 126, low: 123, close: 125 },
                  { time: '2025-10-17', open: 125, high: 128, low: 124, close: 127 },
                  { time: '2025-10-18', open: 127, high: 130, low: 126, close: 129 },
                  { time: '2025-10-21', open: 129, high: 132, low: 128, close: 131 },
              ];
              resolve(mockData); 
          }, 300);
      });
  }

  async function updateCandlestickChart(stockId) {
      // ç¢ºä¿åœ–è¡¨å¯¦ä¾‹å­˜åœ¨
      if (!candleSeries) initCandlestickChart();

      try {
          const data = await fetchPriceData(stockId);
          if (data && data.length > 0) {
              candleSeries.setData(data);
              candlestickChartInstance.timeScale().fitContent();
          } else {
              candleSeries.setData([]);
          }
      } catch (error) {
          console.error("è¼‰å…¥ K ç·šåœ–æ•¸æ“šå¤±æ•—:", error);
          candleSeries.setData([]);
      }
  }


  // --- è¼”åŠ©å‡½å¼ï¼šå‰µå»ºé€£çµ (ä¿æŒä¸è®Š) ---
  function createStockLink(stock_id, name) {
    const a = document.createElement("a");
    a.href = `https://www.cmoney.tw/finance/f00025.aspx?s=${stock_id}`;
    a.target = "_blank";
    a.textContent = `${name} (${stock_id})`;
    a.className = "hover:underline text-black";
    return a;
  }
  
  // --- æ•¸æ“šæ¸²æŸ“èˆ‡è¼‰å…¥å€å¡Š (ä¿®å¾©: å°‡è¼‰å…¥é‚è¼¯åŒ…è£åœ¨DOMContentLoadedä»¥ç¢ºä¿å…ƒç´ å­˜åœ¨) ---
  document.addEventListener("DOMContentLoaded", () => {
    
    // 1. åˆå§‹åŒ– K ç·šåœ–
    initCandlestickChart();
    
    // 2. åˆå§‹é¡¯ç¤ºç¸½è¦½æ¨¡å¼
    toggleView('insights');
    
    // 3. è¼‰å…¥ä¸»è¦äº¤æ˜“æ•¸æ“š
    fetch("data.json")
      .then(res => res.json())
      .then(data => {
        records = data.records;
        records.forEach(day => {
          day.stocks.forEach(s => {
            if (!stockList.find(x => x.id === s.stock_id)) {
              stockList.push({ id: s.stock_id, name: s.name.trim() });
            }
          });
        });
      });

    // 4. è¼‰å…¥ç¸½è¦½æ•¸æ“š (ä¿®å¾©ï¼šç¢ºä¿åˆ—è¡¨æ¸²æŸ“æ­£ç¢º)
    fetch("insights.json")
      .then(res => res.json())
      .then(data => {
        if (data.date) {
          document.getElementById("insights-title").textContent =
            `ğŸ“Š æŒ‡æ¨™è§€å¯Ÿæ¸…å–® (è³‡æ–™æ—¥æœŸï¼š${data.date})`;
        }

        const dailyForeign = (data.foreign_ratio_ranking || []).slice(0, 10);
        const dailyInvest  = (data.invest_ratio_ranking  || []).slice(0, 10);

        const foreignList = document.getElementById("foreign_ratio_list");
        const investList  = document.getElementById("invest_ratio_list");
        foreignList.innerHTML = "";
        investList.innerHTML  = "";

        const dailyBoth = new Set(
          dailyForeign
            .map(i => i.stock_id)
            .filter(id => dailyInvest.some(j => j.stock_id === id))
        );

        const renderListItem = (listEl, items, ratioKey, bothSet, isPeriod = false) => {
          items.forEach(item => {
            const li = document.createElement("li");
            const a = createStockLink(item.stock_id, item.name);

            const ratioValue = (item[ratioKey] * 100).toFixed(2);
            const text = document.createTextNode(` : ${ratioValue}%`);

            if (bothSet.has(item.stock_id)) {
              li.classList.add("text-red-600", "font-bold");
              a.className = "hover:underline text-red-600 font-bold";
            }

            li.appendChild(a);
            li.appendChild(text);
            listEl.appendChild(li);
          });
        };

        renderListItem(foreignList, dailyForeign, 'foreign_ratio', dailyBoth);
        renderListItem(investList, dailyInvest, 'invest_ratio', dailyBoth);

        const periodRoot = document.getElementById("period-section");

        function buildPeriodBlock(titleHTML, foreignKey, investKey, prefix) {
          const section = document.createElement("div");
          section.className = "mt-6 border-t pt-4";
          section.innerHTML = `
            <h4 class="font-bold text-xl mb-3">${titleHTML}</h4>
            <div class="grid grid-cols-2 gap-6 text-gray-700">
              <div>
                <h5 class="font-semibold mb-2 text-base">ğŸŒ å¤–è³‡</h5>
                <ul id="${prefix}-foreign" class="list-disc pl-6 space-y-2 text-base"></ul>
              </div>
              <div>
                <h5 class="font-semibold mb-2 text-base">ğŸ¦ æŠ•ä¿¡</h5>
                <ul id="${prefix}-invest" class="list-disc pl-6 space-y-2 text-base"></ul>
              </div>
            </div>
          `;
          periodRoot.appendChild(section);

          const fList = (data[foreignKey] || []).slice(0, 10);
          const iList = (data[investKey]  || []).slice(0, 10);

          const both = new Set(
            fList.map(i => i.stock_id).filter(id => iList.some(j => j.stock_id === id))
          );

          const fUl = document.getElementById(`${prefix}-foreign`);
          const iUl = document.getElementById(`${prefix}-invest`);

          renderListItem(fUl, fList, 'foreign_ratio', both, true);
          renderListItem(iUl, iList, 'invest_ratio', both, true);
        }

        buildPeriodBlock("ğŸ“… è¿‘5æ—¥å¤–/æŠ•æœ¬æ¯”å‰ 10", "foreign_ratio_5d_ranking", "invest_ratio_5d_ranking", "p5d");
        buildPeriodBlock("ğŸ—“ï¸ è¿‘10æ—¥å¤–/æŠ•æœ¬æ¯”å‰ 10", "foreign_ratio_10d_ranking", "invest_ratio_10d_ranking", "p10d");
      });

    // 5. è¼‰å…¥æ–°ä¸Šæ¦œæ•¸æ“š
    fetch("newcomers.json")
      .then(res => res.json())
      .then(data => {
        const newcomers = data.newcomers || {};
        const container = document.getElementById("newcomers-container");
        container.innerHTML = "";

        const addList = (title, items) => {
          if (items && items.length > 0) {
            const header = document.createElement("p");
            header.className = "font-semibold mt-2";
            header.textContent = title;
            container.appendChild(header);

            const ul = document.createElement("ul");
            ul.className = "list-disc pl-6 space-y-1";
            items.slice(0, 10).forEach(stock => {
              const li = document.createElement("li");
              const a = createStockLink(stock.stock_id, stock.name);
              li.appendChild(a);
              ul.appendChild(li);
            });
            container.appendChild(ul);
          }
        };

        addList("ğŸŒ å¤–è³‡æ–°ä¸Šæ¦œï¼š", newcomers.foreign);
        addList("ğŸ¦ æŠ•ä¿¡æ–°ä¸Šæ¦œï¼š", newcomers.invest);
        if ((!newcomers.foreign || newcomers.foreign.length === 0) &&
            (!newcomers.invest || newcomers.invest.length === 0)) {
          container.textContent = "ï¼ˆä»Šæ—¥ç„¡æ–°ä¸Šæ¦œè‚¡ç¥¨ï¼‰";
        }
      })
      .catch(() => {
        document.getElementById("newcomers-container").textContent = "ç„¡æ³•è¼‰å…¥è³‡æ–™";
      });

    // 6. è¼‰å…¥çˆ†é‡æ•¸æ“š
    fetch("explosive.json")
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("explosive-container");
        container.innerHTML = "";

        if (!data || !data.explosive || data.explosive.length === 0) {
          container.textContent = "ï¼ˆä»Šæ—¥ç„¡çˆ†é‡è‚¡ç¥¨ï¼‰";
          return;
        }

        const ul = document.createElement("ul");
        ul.className = "list-disc pl-6 space-y-1";
        data.explosive.slice(0, 10).forEach(stock => {
          const li = document.createElement("li");
          const a = createStockLink(stock.stock_id, stock.name);
          li.appendChild(a);

          const tag = document.createTextNode(` ${stock.tag}`);
          li.appendChild(tag);
          ul.appendChild(li);
        });
        container.appendChild(ul);
      })
      .catch(() => {
        document.getElementById("explosive-container").textContent = "ç„¡æ³•è¼‰å…¥è³‡æ–™";
      });
  });


  // --- æœå°‹åŠŸèƒ½å€å¡Š (å„ªåŒ–ï¼šç¢ºä¿åœ¨æ‰¾ä¸åˆ°æ•¸æ“šæ™‚ä¸æœƒéŒ¯èª¤åˆ‡æ›åˆ°å€‹è‚¡é ) ---

  input.addEventListener("input", function() {
    if (this.value.trim()) {
      clearBtn.classList.remove("hidden");
    } else {
      clearBtn.classList.add("hidden");
      suggestions.classList.add("hidden");
      toggleView('insights'); // æ¸…ç©ºè¼¸å…¥æ™‚åˆ‡æ›å›ç¸½è¦½æ¨¡å¼
    }

    const keyword = this.value.trim();
    suggestions.innerHTML = "";
    if (!keyword) { suggestions.classList.add("hidden"); return; }
    
    const matched = stockList.filter(s =>
      s.id.includes(keyword) || s.name.includes(keyword)
    ).slice(0, 10);
    
    if (matched.length === 0) { suggestions.classList.add("hidden"); return; }
    
    matched.forEach(s => {
      const li = document.createElement("li");
      li.textContent = `${s.name} (${s.id})`;
      li.className = "p-2 hover:bg-gray-100 cursor-pointer";
      li.addEventListener("click", () => {
        input.value = s.id;
        suggestions.classList.add("hidden");
        clearBtn.classList.remove("hidden");
        showStockData(s.id);
      });
      suggestions.appendChild(li);
    });
    suggestions.classList.remove("hidden");
  });
  
  clearBtn.addEventListener("click", () => {
    input.value = "";
    clearBtn.classList.add("hidden");
    suggestions.classList.add("hidden");
    
    tableBody.innerHTML = `
      <tr>
        <td colspan="5" class="border px-4 py-8 text-gray-500">
          è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼æˆ–åç¨±é€²è¡ŒæŸ¥è©¢
        </td>
      </tr>
    `;
    
    toggleView('insights'); // æ¸…é™¤æŒ‰éˆ•åˆ‡æ›å›ç¸½è¦½æ¨¡å¼
    input.focus();
  });


  input.addEventListener("keyup", e => {
    if (e.key === "Enter") {
      const keyword = e.target.value.trim();
      if (keyword) { showStockData(keyword); suggestions.classList.add("hidden"); }
    }
  });

  // é¡¯ç¤ºå€‹è‚¡æ³•äººè²·è³£è¶… (æ ¸å¿ƒé‚è¼¯ï¼šæŸ¥è©¢æˆåŠŸæ‰åˆ‡æ›æ¨¡å¼)
  function showStockData(keyword) {
    tableBody.innerHTML = "";
    
    const colorize = (val) => {
      const num = Number(val);
      const formattedVal = num.toLocaleString(); 
      if (num > 0) return `<span class="text-red-600">${formattedVal}</span>`;
      if (num < 0) return `<span class="text-green-600">${formattedVal}</span>`;
      return formattedVal;
    };

    const kw = keyword.toString().replace(/\s|ã€€/g, "").trim();
    let foundStock = null;
    let dataFound = false;

    // ç”¨æ–¼åœ–è¡¨çš„æ•¸æ“š
    const chartLabels = [];
    const chartForeignData = [];
    const chartInvestData = [];
    const chartDealerData = [];
    const chartTotalData = [];

    // åå‘è¿­ä»£ records ä»¥ä¾¿åœ–è¡¨æ•¸æ“šå¾èˆŠåˆ°æ–°æ’åˆ—
    for (let i = records.length - 1; i >= 0; i--) {
      const day = records[i];
      const stock = day.stocks.find(s =>
        s.stock_id.toString().replace(/\s|ã€€/g, "").trim() === kw ||
        s.name.replace(/\s|ã€€/g, "").includes(kw)
      );
      if (stock) {
        dataFound = true;
        if (!foundStock) foundStock = stock;
        
        const foreign = Math.round(stock.foreign_net/1000);
        const invest  = Math.round(stock.invest_net/1000);
        const dealer  = Math.round(stock.dealer_net/1000);
        const total   = Math.round((stock.foreign_net + stock.invest_net + stock.dealer_net)/1000);
        
        const tr = document.createElement("tr");
        tr.className = "hover:bg-gray-50";
        tr.innerHTML = `
          <td class="border px-4 py-2">${day.date}</td>
          <td class="border px-4 py-2">${colorize(foreign)}</td>
          <td class="border px-4 py-2">${colorize(invest)}</td>
          <td class="border px-4 py-2">${colorize(dealer)}</td>
          <td class="border px-4 py-2">${colorize(total)}</td>`;
        tableBody.prepend(tr);

        chartLabels.push(day.date);
        chartForeignData.push(foreign);
        chartInvestData.push(invest);
        chartDealerData.push(dealer);
        chartTotalData.push(total);
      }
    }

    if (foundStock && dataFound) {
      // **åªåœ¨æ‰¾åˆ°æ•¸æ“šæ™‚æ‰åˆ‡æ›åˆ°å€‹è‚¡æ¨¡å¼**
      toggleView('stock'); 
      pageTitle.textContent = `æ³•äººè²·è³£è¶…æŸ¥è©¢ - ${foundStock.name} (${foundStock.stock_id})`;
      updateTradingChart(chartLabels, chartForeignData, chartInvestData, chartDealerData, chartTotalData);
      updateCandlestickChart(foundStock.stock_id); 
    } else {
      // **æ‰¾ä¸åˆ°æ•¸æ“šæ™‚ï¼Œç¶­æŒåœ¨ç¸½è¦½æ¨¡å¼ï¼Œä¸¦é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯**
      toggleView('insights'); 
      pageTitle.textContent = "æ³•äººè²·è³£è¶…æŸ¥è©¢";
      const tr = document.createElement("tr");
      tr.innerHTML = `<td colspan="5" class="border px-4 py-8 text-red-500">æ‰¾ä¸åˆ°ç›¸é—œè³‡æ–™ï¼Œæˆ–ä»£ç¢¼è¼¸å…¥éŒ¯èª¤ã€‚</td>`;
      tableBody.appendChild(tr); // éŒ¯èª¤è¨Šæ¯ä»ç„¶å¯«å…¥è¡¨æ ¼(ä½†è¡¨æ ¼æ˜¯éš±è—çš„ï¼Œé€™éƒ¨åˆ†å¯ä»¥å„ªåŒ–ï¼Œä½†ç‚ºäº†å¿«é€Ÿä¿®å¾©å…ˆç¶­æŒ)
    }
  }

  // --- Chart.js æ³•äººè²·è³£è¶…è¶¨å‹¢åœ–åŠŸèƒ½ (ä¿æŒä¸è®Š) ---
  function updateTradingChart(labels, foreignData, investData, dealerData, totalData) {
    const ctx = document.getElementById('tradingChart').getContext('2d');
    if (tradingChartInstance) { tradingChartInstance.destroy(); }
    tradingChartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [
          { label: 'å¤–è³‡', data: foreignData, borderColor: 'rgb(255, 99, 132)', backgroundColor: 'rgba(255, 99, 132, 0.5)', tension: 0.3, fill: false, },
          { label: 'æŠ•ä¿¡', data: investData, borderColor: 'rgb(54, 162, 235)', backgroundColor: 'rgba(54, 162, 235, 0.5)', tension: 0.3, fill: false, },
          { label: 'è‡ªç‡Ÿå•†', data: dealerData, borderColor: 'rgb(75, 192, 192)', backgroundColor: 'rgba(75, 192, 192, 0.5)', tension: 0.3, fill: false, },
          { label: 'åˆè¨ˆ', data: totalData, borderColor: 'rgb(153, 102, 255)', backgroundColor: 'rgba(153, 102, 255, 0.5)', tension: 0.3, fill: false, borderWidth: 2 }
        ]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { tooltip: { mode: 'index', intersect: false, } },
        scales: { x: { title: { display: true, text: 'æ—¥æœŸ' } }, y: { title: { display: true, text: 'è²·è³£è¶…å¼µæ•¸' } } }
      }
    });
  }
  </script>
</body>
</html>
