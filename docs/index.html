<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>每日法人買賣超紀錄</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 40px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #333; color: white; }
    tr:nth-child(even) { background: #f9f9f9; }
    .pos { color: red; font-weight: bold; }
    .neg { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h1>每日法人買賣超紀錄</h1>
  <div id="tables"></div>

  <script>
    async function loadData() {
      // 加時間戳避免快取
      const resp = await fetch("data.json?ts=" + new Date().getTime());
      const data = await resp.json();

      const container = document.getElementById("tables");
      container.innerHTML = "";

      for (const stock in data) {
        const records = data[stock];
        if (!records.length) continue;

        const name = records[0].name;
        const h2 = document.createElement("h2");
        h2.textContent = `${name} (${stock}) - 過去一個月法人買賣超`;
        container.appendChild(h2);

        const table = document.createElement("table");
        table.innerHTML = `
          <tr>
            <th>日期</th>
            <th>外資</th>
            <th>投信</th>
            <th>自營商</th>
            <th>三大法人合計</th>
          </tr>
        `;

        for (const row of records.slice(-20)) { // 只顯示最近 20 筆
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row.date}</td>
            <td class="${row.foreign >= 0 ? 'pos' : 'neg'}">${row.foreign}</td>
            <td class="${row.trust >= 0 ? 'pos' : 'neg'}">${row.trust}</td>
            <td class="${row.dealer >= 0 ? 'pos' : 'neg'}">${row.dealer}</td>
            <td class="${row.total >= 0 ? 'pos' : 'neg'}">${row.total}</td>
          `;
          table.appendChild(tr);
        }

        container.appendChild(table);
      }
    }

    loadData();
  </script>
</body>
</html>
